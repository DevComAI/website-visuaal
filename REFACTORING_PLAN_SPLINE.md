# Plan de Refactorisation - Optimisation Navigation Spline

**Projet :** Visuaal Website
**Date :** 2025-10-22
**Objectif :** Navigation ultra-fluide sans rechargement des composants Spline 3D

---

## üìä Analyse du Probl√®me Actuel

### √âtat des Lieux

**Sc√®nes Spline charg√©es :**
- 12 sc√®nes 3D uniques distribu√©es sur 8 pages
- Taille estim√©e : ~500KB - 2MB par sc√®ne (√† mesurer)
- **Charge totale estim√©e : 6-24MB de ressources 3D**

**Probl√®mes identifi√©s :**

1. **Rechargement √† chaque navigation**
   - Les sc√®nes Spline se rechargent compl√®tement lors du changement de page
   - Pas de cache persistant entre les navigations
   - D√©lai de 1-3 secondes pour l'initialisation de chaque sc√®ne

2. **Architecture Next.js App Router**
   - Chaque page est un composant serveur s√©par√©
   - Hard navigation entre les routes
   - Perte du contexte et du cache navigateur

3. **Strat√©gie de chargement actuelle**
   - Intersection Observer : charge uniquement quand visible
   - Bon pour performance initiale, mauvais pour fluidit√©
   - Pas de pr√©chargement anticip√© des pages suivantes

4. **Absence de cache persistant**
   - Pas de Service Worker
   - Pas de cache IndexedDB pour les sc√®nes
   - D√©pendance totale au cache navigateur HTTP

---

## üéØ Objectifs de la Refactorisation

### Objectifs Principaux

1. **Navigation instantan√©e (< 100ms)**
   - Transition entre pages sans rechargement visible de Spline
   - Pas de flash de placeholders lors de la navigation
   - Exp√©rience SPA-like avec Next.js

2. **Pr√©chargement intelligent**
   - Toutes les sc√®nes Spline charg√©es d√®s l'arriv√©e sur le site
   - Chargement progressif en arri√®re-plan
   - Priorit√© bas√©e sur la probabilit√© de navigation

3. **Cache persistant**
   - Service Worker pour mise en cache des sc√®nes
   - Persistence entre sessions
   - Invalidation intelligente lors des mises √† jour

4. **Performance maintenue**
   - Temps de chargement initial acceptable (< 3s)
   - Pas d'impact n√©gatif sur Core Web Vitals
   - Chargement progressif avec feedback utilisateur

### M√©triques de Succ√®s

- **FCP (First Contentful Paint) :** < 1.5s
- **LCP (Largest Contentful Paint) :** < 2.5s
- **Navigation entre pages :** < 100ms (instant)
- **Taux de r√©ussite du pr√©chargement :** > 95%
- **Taille du cache :** < 30MB total

---

## üèóÔ∏è Strat√©gies Propos√©es

### Option 1 : Service Worker + Preloading Agressif ‚≠ê **RECOMMAND√â**

**Architecture :**
```
[User Arrives]
    ‚Üì
[Load Homepage + Critical Spline]
    ‚Üì
[Background: Preload ALL Spline scenes via Service Worker]
    ‚Üì
[Cache in CacheStorage API]
    ‚Üì
[Navigation = Instant serving from cache]
```

**Avantages :**
- ‚úÖ Persistence entre sessions (cache durable)
- ‚úÖ Contr√¥le total sur la strat√©gie de cache
- ‚úÖ Fonctionne offline apr√®s premier chargement
- ‚úÖ Compatible avec l'architecture Next.js actuelle
- ‚úÖ Pas de refonte majeure du code

**Inconv√©nients :**
- ‚ö†Ô∏è Complexit√© du Service Worker
- ‚ö†Ô∏è Debugging plus difficile
- ‚ö†Ô∏è Gestion de la mise √† jour du cache

**Effort estim√© :** 3-5 jours

---

### Option 2 : Route Prefetching + Scene Pooling

**Architecture :**
```
[User Arrives]
    ‚Üì
[Load Homepage]
    ‚Üì
[Prefetch next.js routes (HTML + JS)]
    ‚Üì
[Preload Spline scenes in global pool]
    ‚Üì
[Reuse scene instances on navigation]
```

**Avantages :**
- ‚úÖ Plus simple que Service Worker
- ‚úÖ R√©utilisation des instances Spline (√©conomie m√©moire)
- ‚úÖ Int√©gration native avec Next.js prefetch

**Inconv√©nients :**
- ‚ö†Ô∏è Pas de persistence entre sessions
- ‚ö†Ô∏è Complexit√© de gestion du pool d'instances
- ‚ö†Ô∏è Risques de memory leaks si mal g√©r√©

**Effort estim√© :** 2-3 jours

---

### Option 3 : Hybrid SPA Mode + Custom Router

**Architecture :**
```
[Single Page App Shell]
    ‚Üì
[All Spline scenes loaded once]
    ‚Üì
[Client-side routing with page transitions]
    ‚Üì
[Show/Hide pages without unmount]
```

**Avantages :**
- ‚úÖ Navigation vraiment instantan√©e (0ms)
- ‚úÖ Contr√¥le total sur les transitions
- ‚úÖ Pas de rechargement jamais

**Inconv√©nients :**
- ‚ùå Refonte majeure de l'architecture
- ‚ùå Perte des avantages SSR de Next.js
- ‚ùå SEO plus complexe
- ‚ùå Gestion manuelle de l'√©tat global

**Effort estim√© :** 7-10 jours
**‚ö†Ô∏è Non recommand√©** - Trop invasif

---

## üöÄ Plan d'Impl√©mentation D√©taill√©

### **Phase 1 : Mesure et Pr√©paration** (1 jour)

#### √âtape 1.1 : Audit des sc√®nes Spline
```bash
# Mesurer la taille r√©elle de chaque sc√®ne
# Cr√©er un script d'audit
```

**Fichier :** `scripts/audit-spline-scenes.js`
```javascript
// Script pour mesurer la taille de chaque sc√®ne
// Tester le temps de chargement de chaque sc√®ne
// Identifier les sc√®nes les plus lourdes
```

**Livrables :**
- Tableau avec URL, taille, temps de chargement de chaque sc√®ne
- Identification des sc√®nes critiques vs secondaires
- Carte de navigation typique (quelles pages sont les plus visit√©es)

#### √âtape 1.2 : Configuration baseline
```bash
# Mesurer les Core Web Vitals actuels
# Lighthouse audits sur toutes les pages
# Cr√©er des benchmarks de r√©f√©rence
```

**Livrables :**
- Rapport Lighthouse actuel (avant optimisation)
- M√©triques de navigation actuelles
- Identification des bottlenecks

---

### **Phase 2 : Service Worker Foundation** (2 jours)

#### √âtape 2.1 : Cr√©er le Service Worker

**Fichier :** `public/sw.js`
```javascript
const CACHE_NAME = 'visuaal-spline-v1';
const SPLINE_SCENES = [
  'https://prod.spline.design/1kfiH0yZ5dSGioTU/scene.splinecode',
  'https://prod.spline.design/YQnsevjGuljq6asJ/scene.splinecode',
  // ... toutes les 12 sc√®nes
];

// Strategy: Cache First avec fallback network
self.addEventListener('fetch', (event) => {
  if (event.request.url.includes('prod.spline.design')) {
    event.respondWith(
      caches.match(event.request)
        .then(cached => cached || fetch(event.request))
    );
  }
});

// Preload all Spline scenes on install
self.addEventListener('install', (event) => {
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then(cache => cache.addAll(SPLINE_SCENES))
  );
});
```

**Fichier :** `src/lib/register-sw.ts`
```typescript
export function registerServiceWorker() {
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js')
        .then(reg => console.log('SW registered'))
        .catch(err => console.error('SW registration failed', err));
    });
  }
}
```

#### √âtape 2.2 : Int√©gration dans l'app

**Fichier :** `src/app/layout.tsx`
```typescript
// Ajouter l'enregistrement du SW
useEffect(() => {
  registerServiceWorker();
}, []);
```

**Livrables :**
- Service Worker fonctionnel
- Cache des 12 sc√®nes Spline
- Strat√©gie Cache-First op√©rationnelle

---

### **Phase 3 : Syst√®me de Preloading Intelligent** (2 jours)

#### √âtape 3.1 : Gestionnaire de pr√©chargement global

**Fichier :** `src/lib/spline-preloader.ts`
```typescript
export class SplinePreloadManager {
  private scenes: Map<string, Promise<void>>;
  private loadOrder: string[][];
  private currentPriority: number = 0;

  constructor() {
    this.scenes = new Map();

    // Ordre de chargement par priorit√©
    this.loadOrder = [
      // Priority 1: Homepage critical
      [
        'https://prod.spline.design/1kfiH0yZ5dSGioTU/scene.splinecode', // INFORM
        'https://prod.spline.design/YQnsevjGuljq6asJ/scene.splinecode', // SUPPORT
        'https://prod.spline.design/SdbEwI9-LUOY0hlb/scene.splinecode', // MODERNIZE
      ],
      // Priority 2: Homepage secondary + About
      [
        'https://prod.spline.design/Sj5w2qinD5unnyvb/scene.splinecode', // AboutUs
        'https://prod.spline.design/X07icIhhYxWFwhO1/scene.splinecode', // About Hero
        'https://prod.spline.design/b5QNjdMLUJW-blFk/scene.splinecode', // About Content
      ],
      // Priority 3: Products
      [
        'https://prod.spline.design/XihlwxPitjwHnwb9/scene.splinecode', // Studio Hero
        'https://prod.spline.design/VhnOlUUBXyLXytif/scene.splinecode', // Studio Content
        'https://prod.spline.design/K3MXxwuzrEPrTBi4/scene.splinecode', // DOOH
        'https://prod.spline.design/63D-bD0D4e6xHPvT/scene.splinecode', // Holo
        'https://prod.spline.design/qDj32pWs0uTcm5kM/scene.splinecode', // Screen
      ],
      // Priority 4: Footer (lowest)
      [
        'https://prod.spline.design/2pGj4e2pJIQVw8CK/scene.splinecode', // Footer
      ]
    ];
  }

  async preloadAll(onProgress?: (loaded: number, total: number) => void) {
    const total = this.loadOrder.flat().length;
    let loaded = 0;

    for (const priorityGroup of this.loadOrder) {
      // Charger chaque groupe en parall√®le
      await Promise.all(
        priorityGroup.map(async (url) => {
          await this.preloadScene(url);
          loaded++;
          onProgress?.(loaded, total);
        })
      );
    }
  }

  private async preloadScene(url: string): Promise<void> {
    if (this.scenes.has(url)) return this.scenes.get(url)!;

    const promise = fetch(url, { mode: 'cors' })
      .then(res => res.blob())
      .then(() => {}); // Just preload, don't process

    this.scenes.set(url, promise);
    return promise;
  }

  async waitForScene(url: string): Promise<void> {
    return this.scenes.get(url) || this.preloadScene(url);
  }
}

export const globalPreloader = new SplinePreloadManager();
```

#### √âtape 3.2 : Hook de pr√©chargement

**Fichier :** `src/lib/hooks/useGlobalPreload.ts`
```typescript
'use client';

import { useEffect, useState } from 'react';
import { globalPreloader } from '../spline-preloader';

export function useGlobalPreload() {
  const [progress, setProgress] = useState(0);
  const [isComplete, setIsComplete] = useState(false);

  useEffect(() => {
    const startPreload = async () => {
      await globalPreloader.preloadAll((loaded, total) => {
        setProgress((loaded / total) * 100);
      });
      setIsComplete(true);
    };

    // D√©marrer apr√®s 2 secondes (laisser le temps pour l'interaction initiale)
    const timer = setTimeout(startPreload, 2000);

    return () => clearTimeout(timer);
  }, []);

  return { progress, isComplete };
}
```

#### √âtape 3.3 : UI de feedback de chargement

**Fichier :** `src/components/ui/PreloadIndicator.tsx`
```typescript
'use client';

import { useGlobalPreload } from '@/lib/hooks/useGlobalPreload';

export function PreloadIndicator() {
  const { progress, isComplete } = useGlobalPreload();

  // Masquer apr√®s compl√©tion
  if (isComplete) return null;

  return (
    <div className="fixed bottom-4 right-4 z-50 bg-black/80 text-white px-4 py-2 rounded-lg text-sm">
      Optimisation en cours... {Math.round(progress)}%
    </div>
  );
}
```

**Livrables :**
- Syst√®me de pr√©chargement prioris√©
- Feedback utilisateur sur le chargement
- D√©tection automatique de fin de pr√©chargement

---

### **Phase 4 : Optimisation Navigation** (1 jour)

#### √âtape 4.1 : Prefetch des routes Next.js

**Fichier :** `src/components/layout/Header.tsx`
```typescript
'use client';

import Link from 'next/link';
import { useEffect } from 'react';
import { useRouter } from 'next/navigation';

export function Header() {
  const router = useRouter();

  useEffect(() => {
    // Prefetch toutes les routes principales apr√®s 3 secondes
    const timer = setTimeout(() => {
      router.prefetch('/about');
      router.prefetch('/studio');
      router.prefetch('/products/dooh');
      router.prefetch('/products/holo');
      router.prefetch('/products/screen');
      router.prefetch('/contact');
    }, 3000);

    return () => clearTimeout(timer);
  }, [router]);

  return (
    // ... navigation avec Link components (prefetch par d√©faut)
  );
}
```

#### √âtape 4.2 : Optimisation du OptimizedSplineViewer

**Fichier :** `src/components/ui/OptimizedSplineViewer.tsx`
```typescript
// Modifier pour utiliser le preloader global
import { globalPreloader } from '@/lib/spline-preloader';

export default function OptimizedSplineViewer({ sceneUrl, ... }) {
  useEffect(() => {
    if (shouldLoad) {
      // Attendre que la sc√®ne soit pr√©charg√©e
      globalPreloader.waitForScene(sceneUrl)
        .then(() => setIsLoaded(true));
    }
  }, [shouldLoad, sceneUrl]);

  // ... reste du composant
}
```

**Livrables :**
- Prefetch automatique de toutes les routes
- Int√©gration du preloader global dans les composants Spline
- Navigation optimis√©e

---

### **Phase 5 : Cache Optimization** (1 jour)

#### √âtape 5.1 : Configuration Next.js

**Fichier :** `next.config.ts`
```typescript
const nextConfig = {
  // ... config existante

  headers: async () => [
    {
      source: '/:path*',
      headers: [
        {
          key: 'Cache-Control',
          value: 'public, max-age=31536000, immutable',
        },
      ],
    },
  ],

  // Ajouter les ressources Spline au domaine de confiance
  async headers() {
    return [
      {
        source: '/(.*)',
        headers: [
          {
            key: 'Link',
            value: '<https://prod.spline.design>; rel=preconnect',
          },
        ],
      },
    ];
  },
};
```

#### √âtape 5.2 : Resource Hints

**Fichier :** `src/app/layout.tsx`
```typescript
export default function RootLayout({ children }) {
  return (
    <html>
      <head>
        {/* Preconnect to Spline CDN */}
        <link rel="preconnect" href="https://prod.spline.design" />
        <link rel="dns-prefetch" href="https://prod.spline.design" />
      </head>
      <body>
        {children}
        <PreloadIndicator />
      </body>
    </html>
  );
}
```

**Livrables :**
- Headers de cache optimis√©s
- Resource hints pour Spline CDN
- Configuration Next.js optimis√©e

---

### **Phase 6 : Testing & Monitoring** (1 jour)

#### √âtape 6.1 : Tests de performance

```bash
# Tests Lighthouse sur toutes les pages
npm run lighthouse

# Tests de navigation
npm run test:navigation

# Tests de cache Service Worker
npm run test:sw
```

#### √âtape 6.2 : Monitoring en production

**Fichier :** `src/lib/analytics/preload-tracking.ts`
```typescript
export function trackPreloadMetrics() {
  // Mesurer le temps de pr√©chargement total
  // Mesurer le taux de r√©ussite
  // Envoyer √† analytics

  if (typeof window !== 'undefined' && window.gtag) {
    window.gtag('event', 'spline_preload_complete', {
      duration_ms: performance.now(),
      scenes_loaded: 12,
    });
  }
}
```

**Livrables :**
- Suite de tests automatis√©s
- Monitoring des m√©triques de pr√©chargement
- Dashboard de performance

---

## üìÅ Architecture des Fichiers (Nouveaux/Modifi√©s)

```
website-visuaal/
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îî‚îÄ‚îÄ sw.js                                    # ‚ú® NOUVEAU - Service Worker
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ audit-spline-scenes.js                   # ‚ú® NOUVEAU - Script d'audit
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ layout.tsx                           # üîÑ MODIFI√â - SW registration
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ OptimizedSplineViewer.tsx        # üîÑ MODIFI√â - Int√©gration preloader
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PreloadIndicator.tsx             # ‚ú® NOUVEAU - UI feedback
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ layout/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ Header.tsx                       # üîÑ MODIFI√â - Route prefetch
‚îÇ   ‚îî‚îÄ‚îÄ lib/
‚îÇ       ‚îú‚îÄ‚îÄ spline-preloader.ts                  # ‚ú® NOUVEAU - Gestionnaire global
‚îÇ       ‚îú‚îÄ‚îÄ register-sw.ts                       # ‚ú® NOUVEAU - SW registration
‚îÇ       ‚îú‚îÄ‚îÄ hooks/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ useGlobalPreload.ts              # ‚ú® NOUVEAU - Hook pr√©chargement
‚îÇ       ‚îî‚îÄ‚îÄ analytics/
‚îÇ           ‚îî‚îÄ‚îÄ preload-tracking.ts              # ‚ú® NOUVEAU - Tracking
‚îî‚îÄ‚îÄ REFACTORING_PLAN_SPLINE.md                   # üìÑ CE DOCUMENT
```

---

## üéØ Strat√©gie de Migration

### Approche Progressive (Recommand√©)

**Semaine 1 : Foundation**
- ‚úÖ Phase 1 : Mesure (1 jour)
- ‚úÖ Phase 2 : Service Worker (2 jours)
- ‚úÖ Phase 3 : Preloading (2 jours)

**Semaine 2 : Optimization**
- ‚úÖ Phase 4 : Navigation (1 jour)
- ‚úÖ Phase 5 : Cache (1 jour)
- ‚úÖ Phase 6 : Testing (1 jour)
- Buffer : 2 jours pour ajustements

**D√©ploiement :**
1. Deploy sur staging avec monitoring
2. Tests A/B sur 10% du trafic
3. Validation des m√©triques
4. Rollout progressif √† 100%

---

## üìä Crit√®res de R√©ussite

### M√©triques Techniques

| M√©trique | Avant | Objectif | Mesure |
|----------|-------|----------|--------|
| Navigation entre pages | ~2-3s | < 100ms | Performance API |
| Taux de cache hit | 0% | > 95% | SW Analytics |
| Taille cache total | 0MB | < 30MB | Cache API |
| FCP | ~1.8s | < 1.5s | Lighthouse |
| LCP | ~3.2s | < 2.5s | Lighthouse |
| Pr√©chargement complet | N/A | < 10s | Custom metric |

### M√©triques UX

- ‚úÖ Pas de flash de placeholder lors de navigation
- ‚úÖ Indicateur de progression visible
- ‚úÖ Navigation per√ßue comme instantan√©e
- ‚úÖ Pas de r√©gression sur mobile

---

## ‚ö†Ô∏è Risques et Mitigation

### Risque 1 : Taille du cache trop importante
**Impact :** Limite de stockage d√©pass√©e
**Probabilit√© :** Moyenne
**Mitigation :**
- Mesurer la taille r√©elle de chaque sc√®ne
- Impl√©menter une strat√©gie d'√©viction si > 30MB
- Tester sur diff√©rents navigateurs (quotas diff√©rents)

### Risque 2 : Service Worker ne fonctionne pas
**Impact :** Pas de cache, retour √† l'√©tat actuel
**Probabilit√© :** Faible
**Mitigation :**
- Fallback gracieux vers chargement normal
- Tests exhaustifs navigateurs
- Logs et monitoring SW

### Risque 3 : Pr√©chargement ralentit l'interaction initiale
**Impact :** D√©gradation FCP/LCP
**Probabilit√© :** Moyenne
**Mitigation :**
- D√©lai de 2s avant d√©marrage du preloading
- Chargement par priorit√© (groupes)
- requestIdleCallback pour t√¢ches non critiques

### Risque 4 : Consommation r√©seau mobile excessive
**Impact :** Mauvaise exp√©rience 4G
**Probabilit√© :** Moyenne
**Mitigation :**
- D√©tection Network Information API
- D√©sactiver preloading sur slow-2g/2g
- Charger uniquement sc√®nes critiques sur mobile

### Risque 5 : Incompatibilit√© Next.js App Router
**Impact :** Service Worker interf√®re avec le routing
**Probabilit√© :** Faible
**Mitigation :**
- Ne cacher que les ressources Spline, pas les routes HTML
- Tests exhaustifs de navigation
- Skip SW pour les requ√™tes /_next/

---

## üîß Configuration Recommand√©e

### Variables d'Environnement

```env
# .env.local
NEXT_PUBLIC_ENABLE_SW=true
NEXT_PUBLIC_ENABLE_PRELOAD=true
NEXT_PUBLIC_PRELOAD_DELAY_MS=2000
NEXT_PUBLIC_SW_VERSION=v1
NEXT_PUBLIC_CACHE_MAX_SIZE_MB=30
```

### Feature Flags

```typescript
// src/lib/config.ts
export const config = {
  serviceWorker: {
    enabled: process.env.NEXT_PUBLIC_ENABLE_SW === 'true',
    version: process.env.NEXT_PUBLIC_SW_VERSION || 'v1',
    cacheMaxSize: parseInt(process.env.NEXT_PUBLIC_CACHE_MAX_SIZE_MB || '30'),
  },
  preload: {
    enabled: process.env.NEXT_PUBLIC_ENABLE_PRELOAD === 'true',
    delayMs: parseInt(process.env.NEXT_PUBLIC_PRELOAD_DELAY_MS || '2000'),
  },
};
```

---

## üö¶ Checklist de D√©ploiement

### Avant Production

- [ ] Audit de toutes les sc√®nes Spline (tailles)
- [ ] Tests Lighthouse sur toutes les pages
- [ ] Tests de navigation automatis√©s
- [ ] Tests Service Worker sur tous les navigateurs
- [ ] Tests mobile (4G, 3G)
- [ ] Validation cache quota sur iOS Safari
- [ ] Tests de mise √† jour du cache (invalidation)
- [ ] Monitoring et analytics en place
- [ ] Documentation technique mise √† jour
- [ ] Feature flags configur√©s

### Apr√®s Production

- [ ] Monitoring 24h des erreurs SW
- [ ] Validation m√©triques Core Web Vitals
- [ ] Tests utilisateurs r√©els (feedback)
- [ ] A/B testing si possible
- [ ] Ajustements bas√©s sur les donn√©es

---

## üìö Ressources Techniques

### Documentation

- [Service Worker API](https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API)
- [Cache Storage API](https://developer.mozilla.org/en-US/docs/Web/API/CacheStorage)
- [Next.js Route Prefetching](https://nextjs.org/docs/app/building-your-application/routing/linking-and-navigating#prefetching)
- [Network Information API](https://developer.mozilla.org/en-US/docs/Web/API/Network_Information_API)
- [Spline Runtime Documentation](https://docs.spline.design/runtime)

### Outils

- Lighthouse CI
- Chrome DevTools (Application > Service Workers)
- Chrome DevTools (Application > Cache Storage)
- Webpack Bundle Analyzer
- Next.js Bundle Analyzer

---

## üé¨ Prochaines √âtapes

### Imm√©diat (Aujourd'hui)

1. **Valider le plan** avec l'√©quipe
2. **Cr√©er un ticket** pour chaque phase
3. **Cr√©er une branche** `feature/spline-optimization`
4. **D√©marrer Phase 1** : Audit des sc√®nes

### Court Terme (Cette Semaine)

1. Impl√©menter Service Worker (Phase 2)
2. Impl√©menter syst√®me de pr√©chargement (Phase 3)
3. Tests initiaux sur staging

### Moyen Terme (Semaine Prochaine)

1. Optimisation navigation (Phase 4)
2. Configuration cache (Phase 5)
3. Tests exhaustifs (Phase 6)
4. D√©ploiement progressif en production

---

## üí° Am√©liorations Futures (Post-MVP)

### Phase 7 : Optimisations Avanc√©es

1. **Compression Spline**
   - N√©gocier avec Spline pour versions compress√©es
   - Brotli compression des sc√®nes
   - Format optimis√© mobile

2. **Progressive Loading**
   - Low-poly preview pendant chargement
   - Streaming des sc√®nes 3D
   - Chunked loading des gros assets

3. **Smart Prefetch**
   - ML pour pr√©dire la navigation
   - Prefetch bas√© sur le scroll
   - Heuristiques de navigation typique

4. **CDN Optimization**
   - Self-host des sc√®nes Spline
   - CDN d√©di√© pour assets 3D
   - Edge caching

5. **Scene Sharing**
   - R√©utiliser les m√™mes sc√®nes entre pages
   - Pool d'instances Spline
   - Shared WebGL contexts

---

## üìù Notes de D√©veloppement

### Gotchas √† √âviter

1. **Service Worker Scope**
   - Le SW doit √™tre √† la racine (`/sw.js`)
   - Ne pas mettre dans `/_next/static/`

2. **Cache Versioning**
   - Toujours incr√©menter `CACHE_NAME` lors des updates
   - Nettoyer les vieux caches dans l'event `activate`

3. **HTTPS Requirement**
   - Service Workers n√©cessitent HTTPS (ou localhost)
   - V√©rifier certificat en production

4. **iOS Safari Limits**
   - Quota de cache limit√© (~50MB)
   - Peut √™tre nettoy√© automatiquement
   - Tester r√©guli√®rement sur iOS

5. **Next.js App Router**
   - Ne pas cacher les routes `/_next/data/`
   - Ne pas interf√©rer avec le routing
   - Cacher uniquement les assets Spline

---

## ‚úÖ Validation Finale

Ce plan de refactorisation propose une **approche progressive et low-risk** pour r√©soudre le probl√®me de rechargement des composants Spline lors de la navigation.

**Timeline estim√©e :** 8-10 jours
**Complexit√© :** Moyenne
**Impact utilisateur :** Tr√®s positif
**ROI :** √âlev√©

**Points cl√©s :**
- ‚úÖ Pr√©chargement de toutes les sc√®nes d√®s l'arriv√©e
- ‚úÖ Cache persistant via Service Worker
- ‚úÖ Navigation per√ßue comme instantan√©e
- ‚úÖ Pas de refonte majeure de l'architecture
- ‚úÖ D√©gradation gracieuse si √©chec

---

**Pr√™t pour impl√©mentation - Attendant validation üöÄ**
